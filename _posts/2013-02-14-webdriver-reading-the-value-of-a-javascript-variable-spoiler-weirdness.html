---
layout: post
title: 'Webdriver: Reading the value of a Javascript variable (spoiler: weirdness)'
date: 2013-02-14 20:49:07.000000000 +01:00
type: post
published: true
status: publish
categories:
- JavaScript
- Testing
- Webdriver
tags: []
meta:
  _edit_last: '1'
author:
  login: michael
  email: thelinmichael@gmail.com
  display_name: michael
  first_name: ''
  last_name: ''
---
<p><a title="http://docs.seleniumhq.org/projects/webdriver/" href="http://docs.seleniumhq.org/projects/webdriver/" target="_blank">Selenium Webdriver</a> gives you the opportunity to execute Javascript through its <a title="http://selenium.googlecode.com/svn/trunk/docs/api/java/org/openqa/selenium/JavascriptExecutor.html" href="http://selenium.googlecode.com/svn/trunk/docs/api/java/org/openqa/selenium/JavascriptExecutor.html" target="_blank">JavascriptExecutor</a>. Webdriver's own functions are usually enough to interact with the browser though.</p>
<p>When using it today, a colleague and I stumbled upon something a bit strange that I can't explain (but would love to know the reason for). We basically wanted to take the value of a Javascript variable called <em>sessionId</em> and make assertions on it.</p>
<p>Our first naïve attempt.</p>
<p>[code]</p>
<p>JavascriptExecutor js = (JavascriptExecutor) webdriver;</p>
<p>String sessionId = (String) js.<a title="http://selenium.googlecode.com/svn/trunk/docs/api/java/org/openqa/selenium/JavascriptExecutor.html#executeScript(java.lang.String, java.lang.Object...)" href="http://selenium.googlecode.com/svn/trunk/docs/api/java/org/openqa/selenium/JavascriptExecutor.html#executeScript(java.lang.String, java.lang.Object...)" target="_blank">executeScript</a>("sessionId");</p>
<p>assertThat(sessionId, is(notNullValue());</p>
<p>[/code]</p>
<p>No luck, the sessionId String object is null even though it's set.</p>
<p>Maybe we need to return the value through a function? Second attempt:</p>
<p>[code]</p>
<p>JavascriptExecutor js = (JavascriptExecutor) webdriver;</p>
<p>String sessionId = (String) js.executeScript("var getSessionId = function() { return sessionId }; getSessionId(); ");</p>
<p>assertThat(sessionId, is(notNullValue());</p>
<p>[/code]</p>
<p>Still null. After searching a bit on the Interwebs, we found an <a title="http://stackoverflow.com/questions/13994393/reading-javascript-variables-using-selenium-webdriver" href="http://stackoverflow.com/questions/13994393/reading-javascript-variables-using-selenium-webdriver" target="_blank">excellent post</a> on Stack Overflow on the same subject. We confirmed that in order to get the value of the variable, you'd need to</p>
<ol>
<li>create a Javascript function that returns the variable, and</li>
<li>outputting it through and <strong>alert</strong>. (?!)</li>
</ol>
<p>[code]</p>
<p><span style="line-height: 1.714285714; font-size: 1rem;">JavascriptExecutor js = (JavascriptExecutor) driver;</span></p>
<p>String sessionId = (String) js.executeScript("var getSessionId = function() { return sessionId }; alert(getSessionId());");</p>
<p>assertThat(sessionId, is(expectedSessionId));</p>
<p>[/code]</p>
<p>What what?</p>
<p>This of course keeps an alert box open which needs to be closed by the test. Not too nice.</p>
<p>We ended up inserting the sessionId into an attribute on the body-tag.</p>
<p>[code]</p>
<p>String expectedSessionId = "612ba6cb-59aa1b6";</p>
<p>JavascriptExecutor js = (JavascriptExecutor) webdriver;</p>
<p>js.executeScript("document.body.setAttribute("\"sessionId\", sessionId)");</p>
<p>String sessionId = webdriver.findElement(By.tagName("body")).getAttribute("sessionId");</p>
<p>assertThat(sessionId, is(expectedSessionId));</p>
<p>[/code]</p>
<p><em>Side note:</em> One could argue that we should've been using QUnit or a similar testing tool. The test's purpose was the verify that the sessionId was passed from a server-side controller class to the view, where it was inserted into a Javascript variable. Two tests, one for the controller (Selenium Webdriver, for example), and one for the Javascript (QUnit), could have been a cleaner solution.</p>
<p><strong>Edit:</strong> Expanding on the elegant, and possibly fairly obvious, comment from Jose Sutilo. It's enough to simply use <em>executeScript("return &lt;variablename&gt;")</em> inside the JavascriptExecutor. As the <a title="http://selenium.googlecode.com/svn/trunk/docs/api/java/org/openqa/selenium/JavascriptExecutor.html" href="http://selenium.googlecode.com/svn/trunk/docs/api/java/org/openqa/selenium/JavascriptExecutor.html"><strong>official documentation</strong></a> says,</p>
<blockquote>
<h4>executeScript</h4>
<p>Executes JavaScript in the context of the currently selected frame or window. The script fragment provided will be executed as the body of an anonymous function.</p></blockquote>
<p>This is why you couldn't just do<em> executeScript("sessionId"), since it would mean that the anonymous function executed by Webdriver would look something like this: </em></p>
<p>[code]</p>
<p>(function() { sessionId })(); // This returns nothing.</p>
<p>[/code]</p>
<p>Treating the argument in executeScript as the body of an anonymous function on the other hand..</p>
<p>[code]</p>
<p>(function() { return sessionId; })(); // returns the value of sessionId.</p>
<p>[/code]</p>
<p><strong>What still confuses me a bit</strong>, is that the Javascript alert function successfully returns a value to the JavascriptExecutor, even though the anonymous function with an alert in it returns nothing.</p>
<p>[code]</p>
<p>(function() { alert(sessionId) })(); // returns nothing.</p>
<p>[/code]</p>
<p>[code]</p>
<p>String sessionId = (String) js.executeScript("var getSessionId = function() { return sessionId }; alert(getSessionId());"); // WORKS!</p>
<p>assertThat(sessionId, is(expectedSessionId));</p>
<p>[/code]</p>
